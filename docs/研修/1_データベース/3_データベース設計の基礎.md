# 3. データベース設計の基礎

- [3. データベース設計の基礎](#3-データベース設計の基礎)
  - [3-1. ER 図の基礎](#3-1-er-図の基礎)
  - [3-2. 排他制御について](#3-2-排他制御について)
  - [3-3. サロゲートキーとナチュラルキーについて](#3-3-サロゲートキーとナチュラルキーについて)
    - [3-3-1. サロゲートキー方式](#3-3-1-サロゲートキー方式)
    - [3-3-2. ナチュラルキー方式](#3-3-2-ナチュラルキー方式)

:::tip この章の Point

1. 設計の仕方ではなく設計書の **\*見方** を覚える。
   - ER 図の理解
   - テーブル定義書の理解

:::

## 3-1. ER 図の基礎

ER 図とは、EntityRelationshopDiagram の略で

Entity = もの

Relationship = 関係

という組み合わせになっている

詳しくは以下を参考にしてみてください。

[若手プログラマー必読！５分で理解できる ER 図の書き方５ステップ | NTT コミュニケーションズ 法人のお客さま](https://www.ntt.com/business/sdpf/knowledge/archive_50.html)

## 3-2. 排他制御について

複数人で１つのデータを更新する場合があります。

システムはデータの整合性を保つ必要があるためその整合性を保つ処理のことを排他制御と言います。

大きく排他制御の方式として`悲観ロック`と`楽観ロック`の２種類あります。

業務の影響度や業種によってもどちらを利用するかは様々ですが一般的な Web 系では`楽観ロック`が多く使われている印象です。

こちらのサイトで詳しく解説されています。

[IT をわかりやすく解説](https://medium-company.com/%E6%82%B2%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%A5%BD%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%AE%E9%81%95%E3%81%84/)

## 3-3. サロゲートキーとナチュラルキーについて

テーブルを設計する際の一意にするキーの設計方式です。
一般的に`サロゲートキー方式`と`ナチュラルキー方式`があります。

どちらが良いというわけではなく現場の文化や風習で決まる印象がありますが、`サロゲートキー方式`が多い印象です。

### 3-3-1. サロゲートキー方式

システムで一意に払い出す業務上意味のない値をキーとする方法。
以下のように採番することが多いです。

| キー | 項目       | 型      | 備考           |
| :--- | :--------- | :------ | :------------- |
| PK   | ID         | INT     | AUTO_INCREMENT |
|      | JAN コード | VARCHAR |                |
|      | 商品名     | VARCHAR |                |

- SQL Server, Oracle: SEQUENCE
- MySQL: AUTO_INCREMENT

#### メリット

- 簡単にデータの一意性が確保できる。
- 業務データが変更になっても主キーや外部キーに影響がない

#### デメリット

- 業務上発生する意味があるデータ（商品番号）等、重複しては行けないデータのため別途ユニークキーを設定する必要がある。

### 3-3-2. ナチュラルキー方式

システムで一意に払い出す業務上使用する値をキーとする方法。

| キー | 項目       | 型      | 備考 |
| :--- | :--------- | :------ | :--- |
| PK   | JAN コード | VARCHAR |      |
|      | 商品名     | VARCHAR |      |

#### メリット

- カラムが減る。
- 一意になるキーについては業務上意味を持つのでわかりやすい。

#### デメリット

- データの変更があった場合作業が大変になることがある。
